---
title: "test_vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{test_vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(ggplot2)
library(gridExtra)
devtools::load_all()
```

This is a sample vignette.

## マアジ

```{r}
year <- 2019
spcs <- "maaji"
maaji <- xl2df(fname = "../tests/testthat/excel/gyokaikyo_dummy_maaji.xlsx",
               year = year,
               spcs = spcs)
```

### 表
```{r}
df2table(maaji, year = 2016)
df2table(maaji, year = 2017)
df2table(maaji, year = 2018)
df2table(maaji, year = 2019)
```
### 近年の太平洋岸のマアジの主要港水揚量

```{r, fig.width = 8, fig.height = 6}
regional_graph(maaji,
               species_regex = "maaji",
               boundary_prefec = "\u548c\u6b4c\u5c71", # wakayama
               unit = "ton")

```

### 月別体長階級別漁獲尾数

```{r, fig.width = 8, fig.height = 16}
bldata <-
  parse_legacy_maaji_length_dist(
    fname = "../tests/testthat/excel/gyokaikyo_dummy_maaji_length_dist.xlsx"
  ) %>%
  tidyr::drop_na(Frequency) %>%
  dplyr::mutate(Region = dplyr::recode(Region,
                                       "鹿児島" = "Kagoshima",
                                       "宮～高" = "Miyazaki-Kochi",
                                       "徳～和" = "Tokushima-Wakayama",
                                       "三～愛" = "Mie-Aichi",
                                       "静～神" = "Shizuoka-Kanagawa",
                                       "千葉以北" = "Northern Chiba"
  )) %>%
  dplyr::mutate(Frequency = Frequency/1E5)


ggplot(bldata %>%
         dplyr::filter(Year %in% c(2019, 2020)),
       aes(x = Length, y = Frequency)) +
         geom_col(aes(fill = Region)) +
  facet_grid(Month~Year) +
  theme_light() +
  xlab("Length class (cm)") +
  ylab("Frequency (million individuals)")
       

```
